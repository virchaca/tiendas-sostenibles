
 <!-- trabajar con mapbox con DOCUMENTACION PROPIA MAPBOX
    y  https://cindr.org/add-events-to-a-mapbox-map-via-php/ y video https://www.youtube.com/watch?v=yiqV9tDdCVc -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <!-- links fuentes e iconos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet">


    <title>Mapa con clinicas</title>

    <link rel="stylesheet" href="assets/css/mapbox.css" type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.css' rel='stylesheet' />
    
      <!-- del video https://www.youtube.com/watch?v=yiqV9tDdCVc para MAPBOX, GEOCODER y JQUERY-->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>  -->

    <style> 
    .marker {
        background-image: url(assets/images/marker15.png);
        background-size: cover;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
    } 

    .mapboxgl-popup {
        max-width: 200px;
    }

    .mapboxgl-popup-content {
        text-align: center;
        font-family: 'Open Sans', sans-serif;
    }
  
    </style>
</head>

<body class="mapbody">    

    <!-- <div id='inputs-container'>  <input type="text" placeholder="Input 1">  <input type="text" placeholder="Input 2">  </div> -->
      
     <h2 class="h2Title"> <img src="assets/images/mapbox-icon.png" alt="" style="width: 40px;"> Localiza nuestras clÃ­nicas</h2>

     <div id='map-container'>
        <div id='map'></div>
    </div>

            <!-- ***************  SCRIPT MAPBOX      ********************************* -->
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiZ2lzZWhhYWciLCJhIjoiY2w1Yzdwcm5kMDR5ZjNjcGo4dXBjMmMydiJ9.ow4piq8-jPA8uA_wahp3ig';
       
        var map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/mapbox/streets-v11', // Estilo del mapa
          projection: 'globe', //muestra como un globo en vez de mapa
          center: [-3.7038, 40.4168], // Coordenadas del centro del mapa (Madrid)
            // center: [-3.7038, 40.4168],  // Coordenadas del centro del mapa, Madrid
          zoom: 2 // Nivel de zoom inicial
        });

                //************************tutorial mapbox********************************

        const geojson1 = {
            type: 'FeatureCollection',
            features: [
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-2.9253, 43.2627]
                },
                properties: {
                    name: 'Nuestra clinica en Bilbao',
                    phone: '999 999 999',
                    address: 'c/ prueba en Bilbao'
                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-1.9812, 43.3183]
                },
                properties: {
                    name: 'NesaWorld ðŸ˜Š San SebastiÃ¡n',
                    phone: '943 44 35 45',
                    address: 'Parque Empresarial Zuatzu, Edif. Europa, 9, Planta 3'
                }
                }
            ]
        };

        // add markers to map
            for (const feature of geojson1.features) {
                // create a HTML element for each feature
                const el = document.createElement('div');
                el.className = 'marker';

                // make a marker for each feature and add to the map
                new mapboxgl.Marker(el)
                .setLngLat(feature.geometry.coordinates).addTo(map)
                .setPopup(
                new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML(
                    `<h3>${feature.properties.name}</h3><p>${feature.properties.phone}</p><p>${feature.properties.address}</p>`
                )
                )
                .addTo(map);
            }

            //***********************FIN tutorial mapbox ********************************


          //************************ TRAER DATOS API ********************************
          //solicitud AJAX, un fetch, para obtener los datos del archivo PHP y luego usar esos datos para crear y mostrar los marcadores en el mapa.
        fetch('api/getAllClinics.php')
                .then(response => response.json())
                .then(data => {
                    data.features.forEach(feature => {
                        // creo con const, un elemento HTML para los marcadores
                        const el = document.createElement('div');
                        el.className = 'marker';

                        // creo con una const lo que quiero que vaya en mi popup y lo llamo abajo 
                        const popupDiv = `
                        <div class="popupStyle">
                            <h3>${feature.properties.name}</h3>
                            <p>${feature.properties.phone}</p>
                            <p>${feature.properties.address}</p>
                            <p>${feature.properties.city}</p>
                        </div>
                    `;

                        // make a marker for each feature and add to the map
                        new mapboxgl.Marker(el)
                            .setLngLat(feature.geometry.coordinates)
                            .setPopup(
                                new mapboxgl.Popup({ offset: 25 })
                                    .setHTML(
                                       popupDiv)
                            )
                            .addTo(map);
                    });
                })
                .catch(error => console.error('Error fetching clinics:', error));

            //************************FIN  TRAER DATOS API ********************************

        

      
  
//   //empezar con data de clinicas
//         map.on('load', function () {
            
//         //place object we will add our events to
//             map.addSource('places',{
//                 'type': 'geojson',
//                 'data': {
//                     'type': 'FeatureCollection',
//                     'features': []
//                 }
//             });

           
         
//     // map.addLayer({
//     //     'id': 'places',
//     //     'type': 'symbol',
//     //     'source': {
//     //         'type': 'geojson',
//     //         'data': '<?php echo json_encode($returnData); ?>'
//     //     },
//     //     'layout': {
//     //         'icon-image': 'assets/images/nesaLogo', // AquÃ­ especificas el icono del cohete
//     //         'icon-size': 1.5,
//     //         'icon-allow-overlap': true
//     //     }
//     // });


//            //add place object to map
//             map.addLayer({
//                 'id': 'places',
//                 'type': 'symbol',
//                 'source': 'places',
//                 'layout': {
//                     'icon-image': 'assets/images/nesaLogoBN.jpeg',
//                     'icon-allow-overlap': true
//                 }
//             });

//             //Handle popups
//             map.on('click', 'places', (e) => {
//                 const coordinates = e.features[0].geometry.coordinates.slice();
//                 const description = e.features[0].properties.description;
//                 while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
//                     coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
//             }
//             new mapboxgl.Popup()
//                 .setLngLat(coordinates)
//                 .setHTML(description)
//                 .addTo(map);
//             });

//             //Handle pointer styles
//             map.on('mouseenter', 'places', () => {
//                 map.getCanvas().style.cursor = 'pointer';
//             });
//             map.on('mouseleave', 'places', () => {
//                 map.getCanvas().style.cursor = '';
//             });

//             //get our data from php function
//             getAllClinics();

//             function getAllClinics(){
//                 $.ajax({
//                     url: "api/getAllClinics.php",
//                     contentType: "application/json",
//                     dataType: "json",
//                     success: function (eventData) {
//                         console.log(eventData)
//                         map.getSource('places')
//                            .setData({
//                                 'type': 'FeatureCollection',
//                                 'features': eventData
//                                 });
//                         },
//                     error: function (e) {
//                         console.log(e);
//                     }
//                 });
//             }

//         });

    </script>



</body>
</html>
